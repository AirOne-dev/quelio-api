# Quelio API - Configuration Nginx (pour Plesk ou serveur Nginx)
# À placer dans la configuration du vhost Nginx

# Protection des fichiers sensibles
# Note: data.json n'est pas bloqué ici car l'endpoint /data.json doit être accessible via le router
# et est protégé par AuthMiddleware::admin() au niveau applicatif
location ~ ^/(config|config\.example)\.php$ { deny all; }
location ~ ^/composer\.(json|lock)$ { deny all; }
location ~ ^/README\.md$ { deny all; }
location ~ /\.git { deny all; }
location ~ /\.ht { deny all; }

# Front controller : tout passer à index.php
location / {
    try_files $uri $uri/ /index.php?$query_string;
}

# Configuration PHP-FPM (si Nginx gère directement PHP)
location ~ \.php$ {
    # Autoriser uniquement index.php
    if ($uri !~ ^/index\.php$) {
        return 404;
    }

    fastcgi_pass unix:/var/run/php/php-fpm.sock;  # Ajuster selon votre config
    fastcgi_index index.php;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    include fastcgi_params;

    # Préserver la méthode HTTP
    fastcgi_param REQUEST_METHOD $request_method;
}
