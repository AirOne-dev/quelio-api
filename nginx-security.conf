# Fichier de sécurité réutilisable pour Nginx
# Peut être inclus dans votre configuration principale avec: include /path/to/nginx-security.conf

# Désactiver l'affichage du listing des répertoires
autoindex off;

# Bloquer l'accès aux fichiers cachés (.git, .gitignore, etc.)
location ~ /\. {
    deny all;
    return 404;
}

# Bloquer l'accès aux fichiers de configuration
location ~ ^/(config\.php|config\.example\.php)$ {
    deny all;
    return 404;
}

# Bloquer l'accès au fichier de données
location ~ ^/data\.json$ {
    deny all;
    return 404;
}

# Bloquer l'accès aux fichiers README et documentation
location ~ ^/README\.md$ {
    deny all;
    return 404;
}

# Bloquer l'accès à tous les fichiers PHP sauf index.php
location ~ ^/(?!index\.php$).+\.php$ {
    return 404;
}

# Bloquer l'accès aux autres types de fichiers
location ~* \.(json|md|log|txt|xml|yml|yaml)$ {
    deny all;
    return 404;
}

# Configuration pour index.php
location / {
    try_files $uri $uri/ /index.php$is_args$args;
}

# Traitement PHP pour index.php uniquement
location ~ ^/index\.php$ {
    fastcgi_pass unix:/var/run/php/php8.2-fpm.sock;  # Ajustez selon votre version PHP
    fastcgi_index index.php;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    include fastcgi_params;

    # Paramètres de sécurité
    fastcgi_param PHP_VALUE "upload_max_filesize=10M \n post_max_size=10M";
    fastcgi_read_timeout 300;
}
