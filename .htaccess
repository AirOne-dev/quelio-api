# Configuration Apache pour Quelio API
# Ce fichier protège l'accès aux fichiers sensibles et n'autorise que l'accès à index.php

# Désactiver MultiViews et le listing des répertoires
Options -MultiViews -Indexes

<IfModule mod_rewrite.c>
    RewriteEngine On

    # Bloquer l'accès aux fichiers cachés (.git, .gitignore, .htaccess, etc.)
    RewriteRule ^\.(.*)$ - [F,L]

    # Bloquer l'accès aux fichiers de configuration
    RewriteRule ^(config|config\.example)\.php$ - [F,L]
    RewriteRule ^(README\.md|composer\.(json|lock))$ - [F,L]

    # Rediriger manifest.json, icon.svg et data.json vers index.php (le router gérera la route)
    RewriteRule ^(manifest\.json|icon\.svg|data\.json)$ index.php [QSA,L]

    # Bloquer tous les fichiers PHP sauf index.php
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_URI} !^/index\.php$
    RewriteCond %{REQUEST_FILENAME} \.php$
    RewriteRule .* - [R=404,L]
</IfModule>

# Protéger les fichiers sensibles (couche supplémentaire de sécurité)
# Note: data.json est accessible via le router avec authentification admin
<FilesMatch "^(config\.php|config\.example\.php|\.git.*|\.htaccess|composer\.(json|lock))$">
    Require all denied
</FilesMatch>

# Autoriser uniquement index.php
<FilesMatch "\.php$">
    <If "%{REQUEST_URI} !~ m#^/index\.php$#">
        Require all denied
    </If>
</FilesMatch>

# Retourner 404 pour les accès interdits
ErrorDocument 403 /index.php
