# Quelio API - Configuration Apache
# Front Controller Pattern : toutes les requêtes → index.php

# Désactiver MultiViews (important pour éviter les comportements inattendus)
Options -MultiViews -Indexes

# Protection des fichiers sensibles
# Note: data.json n'est pas bloqué ici car l'endpoint /data.json doit être accessible via le router
# Le fichier physique data.json est protégé par les règles de rewrite (les .json ne sont pas servis directement)
# et l'endpoint /data.json est protégé par AuthMiddleware::admin() au niveau applicatif
<FilesMatch "^(config|config\.example)\.php$|^composer\.(json|lock)$|^README\.md$|^\.(git|htaccess)">
    Require all denied
</FilesMatch>

# Redirection front controller
<IfModule mod_rewrite.c>
    RewriteEngine On

    # Si le fichier existe (sauf .svg et .json), le servir directement
    RewriteCond %{REQUEST_FILENAME} -f
    RewriteCond %{REQUEST_URI} !\.(svg|json)$
    RewriteRule ^ - [L]

    # Toutes les autres requêtes → index.php
    # Cela s'applique AVANT que Apache ne fasse sa redirection DirectorySlash
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteRule ^ index.php [QSA,L]
</IfModule>

# Si mod_rewrite n'est pas disponible, utiliser FallbackResource
<IfModule !mod_rewrite.c>
    FallbackResource index.php
</IfModule>
